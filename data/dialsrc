
logging {
  version = 1
    .type = int
  disable_existing_loggers = True
    .type = bool

  formatters {
    standard {
      format = '%(asctime)s [%(levelname)s] %(name)s: %(message)s'
        .type = str
    }
  }

  handlers {
    console {
      level = DEBUG INFO *WARN ERROR CRITICAL NOTSET
        .type = choice
      class = 'logging.StreamHandler'
        .type = str
      formatter = *standard
        .type = choice
    }
    file {
      level = DEBUG *INFO WARN ERROR CRITICAL NOTSET
        .type = choice
      class = 'logging.FileHandler'
        .type = str
      formatter = *standard
        .type = choice
      directory = '~/.dials'
        .type = str
    }
  }

  loggers {
    default {
      handlers = *console *file
        .type = choice(multi=True)
      level = *DEBUG INFO WARN ERROR CRITICAL NOTSET
        .type = choice
      propagate = True
        .type = bool
    }
  }
}

background
  .help = "Parameters used in the background subtraction algorithm."
{

  algorithm = *xds flat curved
      .help = "The background subtraction algorithm."
      .type = choice

  min_pixels = 10
    .help = "The minimum number of pixels to use in calculating the"
            "background intensity."
    .type = int

  sigma_background = 3.0
    .help = "The number of standard deviations above the mean pixel intensity"
            "below which the pixel will be classified as background."
    .type = float
}

spotfinder
  .help = "Parameters used in the spot finding algorithm."
{
  scan_range = None
    .help = "The range of images to use in finding spots. Number of arguments"
            "must be a factor of two. Specifying \"0 0\" will use all images"
            "by default. The given range follows C conventions"
            "(e.g. j0 <= j < j1)."
    .type = ints(size=2)
    .multiple = True

  threshold
    .help = "Parameters used in the spot finding threshold strategy."
  {
    algorithm = *xds unimodal lui
      .help = "The threshold strategy."
      .type = choice

    kernel_size = 3 3
      .help = "The size of the local area around the spot in which"
              "to calculate the mean and variance. The kernel is"
              "given as a box of size (2 * nx + 1, 2 * ny + 1) centred"
              "at the pixel."
              ""
              "Used by: xds."
      .type = ints(size=2)

    sigma_background = 6
      .help = "The number of standard deviations of the coefficient of"
              "variation (variance / mean) in the local area below"
              "which the pixel will be classified as background."
              ""
              "Used by: xds."
      .type = float

    sigma_strong = 3
      .help = "The number of standard deviations above the mean in the"
              "local area above which the pixel will be classified as"
              "strong."
              ""
              "Used by: xds."
      .type = float

    noise_file = ''
      .help = "A file containing a map of the dark current across the"
              "detector."
              ""
              "Used by: xds."
      .type = str

    gain_file = ''
      .help = "A file containing a map of the detector gain."
              ""
              "Used by: xds."
      .type = str

    times = 5
      .help = "How many times to run the smoothing algorithm."
              ""
              "Used by: lui"
      .type = int

    block_size = 5 12
      .help = "How many (nx x ny) blocks per image."
              ""
              "Used by: lui"
      .type = ints(size=2)

    shift = 10
      .help = "The shift value (in counts) added to the threshold."
              ""
              "Used by: lui"
      .type = int

    dimensions = *2d 3d
      .help = "Use the 2D or 3D smoothing algorithm."
              ""
              "Used by: lui"
      .type = choice
  }

  filter
    .help = "Parameters used in the spot finding filter strategy."

  {
    min_spot_size = 6
      .help = "The minimum number of contiguous pixels for a spot"
              "to be accepted by the filtering algorithmÂ·"
              ""
              "Used by: xds."
      .type = int

    max_separation = 2
      .help = "The maximum peak-to-centroid separation (in pixels)"
              "for a spot to be accepted by the filtering algorithm."
              ""
              "Used by: xds."
      .type = float
  }
  image_viewer = False
    .help = "Display the results of spot finding in an interactive image"
            "viewer."
    .type = bool
}
